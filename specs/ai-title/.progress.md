---
spec: ai-title
phase: tasks
task: 7/32
updated: 2026-01-19T17:00:00Z
---

# Progress: ai-title

## Original Goal

Currently we are using AI to suggest the title of the task. It is not very useful. We need to take into consideration the email subject and contents of the email to recommend the title. If it is just a web page use the page contents for title recommendation.

## Completed Tasks

- [x] Research phase complete - research.md created
- [x] Requirements phase complete - requirements.md created
- [x] Design phase complete - design.md created
- [x] 1.1 Extend AIInput type with new fields
- [x] 1.2 Extend GmailEmailInfo type
- [x] 1.3 Extend OutlookEmailInfo type
- [x] 1.4 Add getEmailBody() to Gmail content script
- [x] 1.5 Add getEmailSender() to Gmail content script
- [x] 1.6 Update Gmail message listener to include new fields
- [x] 1.7 Add getEmailBody() to Outlook content script
- [x] 1.8 Enhance getSenderInfo() in Outlook content script - 7fac331
- [x] 1.9 Update Outlook message listener to include new fields

## Current Task

Awaiting next task

## Learnings

### Verification: V1 [VERIFY] Quality checkpoint: types and Gmail changes
- Status: PASS
- Commands: pnpm check-types (0), pnpm lint (0)
- Duration: ~3s
- All type definitions and Gmail content script changes compile cleanly

- Current AI title generation only uses `pageTitle`, `selectedText`, `emailSubject`, `pageUrl` - missing email body content
- Gmail content script already extracts subject via DOM selectors but not email body
- Outlook content script extracts subject but not email body
- Bug found: popup uses `document.title` which is popup's title, not page title
- AIInput type needs extension with `emailBody`, `emailSender`, `pageContent`, `contentType`
- Best practice: XML-structured prompts work well with Claude
- Best practice: Put source text ABOVE prompt (recency effect)
- Best practice: Start task titles with action verbs (Review, Follow up, Schedule)
- Best practice: Preserve specifics (names, dates, invoice numbers) in titles
- Token budget consideration: Email bodies should be truncated to ~1000 chars
- DOM selectors for email body extraction may need maintenance as Gmail/Outlook update their UIs
- Haiku model is adequate but larger prompts = slower/costlier calls
- Requirements: Selected text should take priority when present (user intent signal)
- Requirements: Graceful degradation at every extraction point is critical
- Requirements: contentType discrimination helps prompt select appropriate extraction strategy
- Requirements: Edge case handling needed for confidential emails, empty bodies, multi-language
- Requirements: Success criteria should include action verb presence rate
- Design: Use chrome.scripting.executeScript for page content extraction to avoid new content scripts
- Design: Outlook already has getSenderInfo() - enhance with fallback selectors rather than rewrite
- Design: Gmail body selectors: .a3s.aiL, [data-message-id] .ii.gt, .adn.ads
- Design: Outlook body selectors: [data-app-section="ConversationReadingPane"], .XbIp4.jmmB7.GNqVo
- Design: Plain text prompt works better than XML for this use case with Haiku
- Design: 15 implementation steps identified, mostly modifications to existing files

## Blockers

- None currently

## Next

Task V2: Quality checkpoint - Outlook changes

## Task Planning Insights

- 32 total tasks: 18 POC, 3 refactoring, 7 testing, 4 quality gates
- 8 [VERIFY] checkpoints distributed throughout all phases
- POC phase is self-contained: types first, then Gmail, then Outlook, then popup, then AI module
- E2E tests may require additional Playwright/Puppeteer setup for Chrome extension testing
- Integration tests can mock chrome.* APIs using existing patterns from service-worker.integration.test.ts
- All tasks have automated verification commands - no manual testing required
- DOM selector risk mitigated by multiple fallback selectors and debug logging
